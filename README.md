
# python redis api for securities analytical data

## Requirement

For 500K data of 200 attributes, provide efficient python api to store and get data from redis. Users may want to update some of these attributes, the other attributes should not be affected!

## API design

```
store()  
gets()   
getall()   
deletes()
```

Here is 4 ways to implement:
0. hmset()   
1. data_dict -> obj init -> data_list -> msgpack -> redis
2. data_dict -> data_list -> msgpack -> redis
3. dict -> msgpack -> redis  
this version using the last way is faster than the others.  
redis pipeline and multiprocessing was used in this project.


## How to use

environment:    
__python2.7__


__pip install -r requirements.txt__

```
   Security.store({'ssm_id':"test1", 'a':9.32})
   
   Security.store({'ssm_id':"test1", 'a':9.32}, protection=False) 
```
       *(protection=False can make it faster, but will overwrite old attributes data)*
       
       



```
   Security.store([{'ssm_id':"test1", 'a':9.32},{'ssm_id':"test2", 'b':4.32, 'jwzh':5.11}])
   
   Security.gets(['test1','test2'])
   
   Security.getall()
   
   Security.deletes(['id1','id2'])
```

## TEST

### Generate test data

generate 100k data with 200 attributes for test!


```python
import test_engine as zj_test_engine
```


```python
_AMOUNT = 100000
_COLUMNS = 200
sec_pd = zj_test_engine.gen_sec_data_frame(_AMOUNT, _COLUMNS)
source_datas = zj_test_engine.gen_source_data(sec_pd)
```

The first of source data:  


```python
print source_datas[0]
```

    {'a161': 0.4183540830950066, 'ssm_id': 'test_V2_ssm_id21001', 'a99': -0.8411444290881166, 'a98': -0.04680684648726844, 'a95': 0.8114107509985942, 'a94': 1.343758068169928, 'a97': -1.215831532300319, 'a96': -1.6437090524686822, 'a91': 0.067270566539239, 'a90': -0.1365033627472331, 'a93': -0.9685443602048119, 'a92': -1.8348082642240378, 'a79': -1.2213646773359639, 'a78': 0.14619389069156583, 'a77': 0.5731528534281667, 'a76': 0.46318007042956183, 'a75': -0.4066443605368481, 'a74': 1.350695265902057, 'a73': 0.9398696589909766, 'a72': -0.8213175441976972, 'a71': -1.1994674606203561, 'a70': 0.2921378595612696, 'a82': 2.6167362680691113, 'a83': -0.024404795572408978, 'a80': 0.9219983129943422, 'a81': 0.2795697331167242, 'a86': -0.49553904914750824, 'a87': -0.9854728757886785, 'a84': 0.81497588718954, 'a85': -0.0884308310099484, 'a88': 1.4236523238109824, 'a89': 0.8109429178567656, 'a159': 0.19018209721308657, 'a128': -1.2002592599193345, 'a129': -0.011913219897098395, 'a120': -1.1253292633645624, 'a121': -1.130446346038179, 'a122': -0.22478076634381197, 'a123': 0.31291169817893516, 'a124': -1.0923723856958087, 'a125': 2.222820262709322, 'a126': -1.336442002496662, 'a127': 0.9097396096720481, 'a68': 0.20915407742777206, 'a69': 0.21267381110552672, 'a64': 1.786765788930988, 'a65': -1.6935715015679729, 'a66': -1.9479750417507309, 'a67': 1.46547360734927, 'a60': 1.6638066834662584, 'a61': 0.042698290287269486, 'a62': 1.0915450286035844, 'a63': -0.6735977069239322, 'a164': -0.6121151102403597, 'a165': 0.15897947416872968, 'a166': 1.0829901649906044, 'a139': -0.17731067601945194, 'a138': -0.09825322905695723, 'a133': -0.5016329751089889, 'a132': -2.237592868045408, 'a131': -0.6243739548948859, 'a130': 0.8197329058813668, 'a137': -0.06562694665236216, 'a136': -0.42387079290876734, 'a135': 0.734492421787166, 'a134': -0.8612441640959592, 'a162': -0.6115314662892066, 'a163': -0.6888963771920251, 'a188': -0.7942617575774898, 'a189': -0.11564001980160216, 'a186': 0.01713745396767939, 'a167': -1.6779608283462217, 'a184': -0.8888569423484587, 'a185': -0.11784642373710656, 'a182': 0.18606092905125204, 'a183': 0.12809392572901634, 'a180': -0.1302705372814802, 'a181': -0.5851694877939971, 'a106': -0.5936451037090216, 'a107': -0.5318704162579273, 'a104': 1.0565198256454977, 'a105': 1.0133579427421444, 'a102': -0.005725053904347235, 'a103': 1.8855018050138777, 'a100': -1.1383512364706634, 'a101': 0.8764051980537737, 'a108': 0.6769033510766417, 'a109': 0.662938169435858, 'a160': 0.6204777771833264, 'a199': 0.5847843252613993, 'a198': 0.6659995781817973, 'a187': 0.7771316679198181, 'a191': -0.07235531062501882, 'a190': -0.39695651952739996, 'a193': -1.4495530069268985, 'a192': -0.7679389923427049, 'a195': -0.13887165904291962, 'a194': 0.01800743526439355, 'a197': 0.6065093671934925, 'a196': -0.011225550515837549, 'a111': 0.4765164291004807, 'a110': -1.8934424901297542, 'a113': -1.7305546937664764, 'a112': 1.6040894813981725, 'a115': -1.5287117767569072, 'a114': -0.2344855626005115, 'a117': 0.985887297301785, 'a116': 0.962920963885846, 'a119': -0.1105890878506277, 'a118': -0.43122999429053005, 'a51': -1.4238134401344038, 'a50': -1.242220859161416, 'a53': -0.7334504054224742, 'a52': 1.6271995361926994, 'a55': 1.082090097405937, 'a54': -0.6714325361590362, 'a57': 0.8654772344570519, 'a56': 0.14967687784401015, 'a59': 0.2031690411415822, 'a58': 0.7050758149765017, 'a158': 1.127835976280663, 'a33': -0.18893985755411583, 'a32': -1.7092606070001855, 'a31': 1.3447298199105637, 'a30': 1.3780125325799317, 'a37': 0.8685530671559224, 'a36': 1.5044969348320234, 'a35': -0.5235594695261401, 'a34': -0.05954851730959353, 'a39': 0.26142273559340456, 'a38': -0.7315986226499104, 'a155': 0.573221782994938, 'a154': -0.1631906223388569, 'a157': -1.0798496558567912, 'a156': -0.645948071875383, 'a151': 1.1290258118397267, 'a150': 0.14381600614840157, 'a46': 0.44813329930598556, 'a47': 0.32700523845551316, 'a44': 0.2493706666294762, 'a45': 0.5468551710467832, 'a42': 0.12249123285279388, 'a43': -0.14120384279770853, 'a40': 1.328162502634253, 'a41': 0.27512823080400667, 'a152': -0.2641104126097804, 'a168': -0.6606872355293415, 'a169': -1.38574901087675, 'a48': 0.16344144059510132, 'a49': -0.3886369617961484, 'a20': 0.7369171636286447, 'a21': 1.1285756935946507, 'a22': 0.1260601179103229, 'a23': -0.09649402310937703, 'a24': -1.179186512128676, 'a25': 0.1391793153434499, 'a26': 0.9960910090288291, 'a27': -1.6127369947745964, 'a28': -1.0061614098600637, 'a29': -0.26241428625742824, 'a177': -0.5198601377229544, 'a176': -0.8979956056569695, 'a175': 0.5115642933046792, 'a174': -0.6579714487537955, 'a173': 0.48325750528190276, 'a172': -1.8867809044842387, 'a171': -0.9675102532118395, 'a170': 0.06987830354586407, 'a153': -1.1217770838352692, 'a179': 0.7519056607158386, 'a178': 1.0248491356068252, 'a15': -0.31838710950313553, 'a14': -1.225225621586911, 'a17': -0.6345065179951362, 'a16': -1.0955828512938899, 'a11': -0.473211860850024, 'a10': 0.1334869630799837, 'a13': 0.1309657615925536, 'a12': -0.406984873208875, 'a19': 0.46213919781284496, 'a18': 1.2958799163477503, 'a1': 0.13652617482790633, 'a0': 1.4066132117977648, 'a3': 0.055506686348536595, 'a2': -1.018892957268057, 'a5': -0.39004945032019395, 'a4': -1.0632191063440157, 'a7': 0.7422368532134024, 'a6': 1.021382442615706, 'a9': -0.5498145511389694, 'a8': -0.27247587281310287, 'a142': -0.07406761866375806, 'a143': -0.13726111469572236, 'a140': 0.1822186670372532, 'a141': -1.5585258707473104, 'a146': -0.7293547525530106, 'a147': -0.5974618327734024, 'a144': -0.7092081712647363, 'a145': 0.020860211944647267, 'a148': -0.5381715576580125, 'a149': -0.5851115334684008}



```python
print 'Here are ',len(source_datas),' number of this kind of test data!'
```

    Here are  100000  number of this kind of test data!


### Test case

#### case 1:   
In the morning, Li Lei run some linear regression analysis scripts for the 100K number of securities, and generate 200 attributes for each security.  
He now wants to store all those data into redis.


```python
import security as sec
failed_ids = sec.Security.store(source_datas)
```

__ATTENTION__  
1. Normally store 100k data takes 10 seconds, if this performance is not enough to you, you can use sec.Security.store(source_data, __protection=False__) to make it more fast. __but this will overwrite all the old attributes__

2. When it comes to big data, like 500k source data, some machine with small memory may cause 'cannot allocate memory error', using below piece of code to avoid this error.   

```
if length<200000:
      sec.Security.store(source_data)
  else:
      group = 5
      splits = length/group+1
      for i in range(group):
          sec.Security.store(source_data[i*splits:(i+1)*splits])
          
```




```python
print 'failed ssm id list: ',failed_ids
if len(failed_ids)==0:
    print 'all data store succeed!'
```

    failed ssm id list:  []
    all data store succeed!


#### case 2:      

He wants to get some security from redis


```python
check_ids = ['test_V2_ssm_id1','test_V2_ssm_id9']
datas = sec.Security.gets(check_ids)
print datas
```

    [{'a93': -0.7901638254836192, 'a42': 0.19478940358113253, 'a138': 0.9328550670349666, 'a159': 1.7401810624258232, 'a98': -0.6880708842255099, 'a95': -1.6919388984755945, 'a94': 1.0705239109426568, 'a97': -1.8787482553066475, 'a96': 1.5095715542677723, 'a91': 1.012722616866618, 'a90': 0.5692824778509995, 'a153': -0.31961227844282564, 'a92': 1.9130723331117339, 'a79': -1.10235680789109, 'a78': 1.2584349292468497, 'a77': 0.4544666517647573, 'a76': 0.5877333828226375, 'a75': -0.3299536228634097, 'a74': -0.02970560959417696, 'a73': -0.4714535243323467, 'a72': -0.560525275557847, 'a71': 0.6046009820542881, 'a70': -0.0382287835981721, 'a43': 0.9285096757486772, 'a82': 0.05372388247273641, 'a83': 0.32087202545978183, 'a80': -0.5560761437827731, 'a81': 0.6760809640882651, 'a86': -1.116429468978824, 'a87': 0.4459889146686136, 'a84': 0.5416077442976445, 'a85': 1.2403757056894091, 'a88': 0.4458584135006776, 'a89': 0.5700257315128165, 'a128': -0.08490875679251968, 'a129': -2.1869235111946517, 'a120': -0.3552659827692538, 'a121': -0.3035877170563286, 'a122': 0.08266906764574068, 'a123': -0.8706676918959142, 'a124': -1.670585736607352, 'a125': -0.37789993374816094, 'a126': 0.16948407846327387, 'a127': 0.02284108315919301, 'a68': 0.148349455159237, 'a69': 0.0684610728077633, 'a64': 0.3598496733089415, 'a65': 0.5288159094204423, 'a66': 0.7934697245002568, 'a67': -0.19880185951934337, 'a60': -0.5213558956094688, 'a61': 1.4336705169509678, 'a62': -0.44994665559454367, 'a63': -0.13165761581488036, 'a46': 2.2111613463961777, 'a47': 0.053891604374681774, 'a44': -0.4647719132954025, 'a139': 0.37473224102820635, 'ssm_id': 'test_V2_ssm_id1', 'a133': -0.05622534888709402, 'a132': -0.0621390302498785, 'a131': 0.42615505662516273, 'a130': -0.33199949783509214, 'a137': -0.20448085486615813, 'a136': -0.48324124236683247, 'a135': 1.8848141103764122, 'a134': 0.9201238471424494, 'a40': -0.1763099881412663, 'a41': -1.5081429361343488, 'a188': -0.7320378869806728, 'a189': 0.17646726822839048, 'a186': -1.0246506067398078, 'a187': 0.8529071779160186, 'a184': -0.6785005551210315, 'a185': 0.5432444461609544, 'a182': -0.2881519223855559, 'a183': -0.016231943683846523, 'a180': -0.9909407099218271, 'a181': -0.49737255589108337, 'a106': -0.29243160329705187, 'a107': -0.44125510378445687, 'a104': 1.3315451604949735, 'a105': -0.6167310310634676, 'a102': 0.3043788913567796, 'a103': -0.12119724947277023, 'a100': -0.42662509690967404, 'a101': -1.0059565166985736, 'a108': -1.7268096323314497, 'a109': -0.5000001296025387, 'a199': 0.33593435805031074, 'a198': 0.29619673653208034, 'a191': -0.23680191322436042, 'a190': 1.590692185464707, 'a193': -1.2376138510561485, 'a192': 0.4480255451611155, 'a195': -1.303996354738306, 'a194': -0.6457988715731815, 'a197': 0.04070373219600614, 'a196': -0.38167437690817163, 'a111': -0.11638844694568136, 'a110': -0.5352515197911191, 'a113': -0.7318819233895445, 'a112': 0.3563833598132746, 'a115': 0.11849701838076875, 'a114': 0.3676319368929684, 'a117': -0.2983166475258596, 'a116': -0.5029645914906519, 'a119': -0.4393553640832666, 'a118': 0.9241762796997699, 'a51': -0.02644146782201883, 'a50': -0.9149091325831891, 'a53': -0.12008236106058806, 'a52': 0.045836558307100025, 'a55': 0.12433699666587236, 'a54': -1.287687247666579, 'a57': -0.5695543999361253, 'a56': 0.9339240554217717, 'a59': 1.5698510485552664, 'a99': 0.7808225446157185, 'a58': -0.7437813470933133, 'a158': 2.4870531597193577, 'a33': 1.0672649210269636, 'a32': 1.4979129275825653, 'a31': 0.6209164098322295, 'a30': -0.8896584529046971, 'a37': -0.5881493014729661, 'a36': 2.4935650282159845, 'a35': -0.4018262615731213, 'a34': -0.5970640000666445, 'a39': 0.4673322883399793, 'a38': -0.07271782427555129, 'a155': 1.2397132979001935, 'a154': 0.6567342619084316, 'a157': -0.5649843965323834, 'a156': 0.788392028821999, 'a151': -0.1058226298147818, 'a150': -0.18350672067101315, 'a164': 1.8895555085391305, 'a165': -0.2928704571270497, 'a166': -1.1480088012141851, 'a45': -0.14651702478454587, 'a160': 0.7289074410262092, 'a161': -0.2916810666355655, 'a162': 1.1035137850188563, 'a163': 0.6645873718524806, 'a152': 0.11155135609563165, 'a168': -1.6499970669425346, 'a169': 0.8707512210935912, 'a48': 0.8395746983741659, 'a49': 0.49705940507432145, 'a20': 0.3900266363312253, 'a21': -0.5391835392145072, 'a22': 0.7509943867757455, 'a23': -0.11725205265384828, 'a24': 0.22464254644116466, 'a25': 0.2697084891363144, 'a26': -1.061800307067855, 'a27': 1.0171611592537617, 'a28': 0.27033414572534215, 'a29': 1.727619124952215, 'a177': -1.120590962148137, 'a176': -1.0175421407923928, 'a175': 0.4707008170255497, 'a174': 1.7773773414120408, 'a173': 0.2566827219628899, 'a172': -0.7811693808845462, 'a171': -0.10397723563467128, 'a170': 0.003124309299923631, 'a167': 1.6568483713095072, 'a179': 0.32385200513011014, 'a178': -0.07430835407568959, 'a15': -1.09897155683586, 'a14': -0.7369500831922443, 'a17': 1.8852498386002008, 'a16': 0.5766734334828075, 'a11': -0.13188287065606566, 'a10': 1.0039031138953314, 'a13': -3.1352465063991697, 'a12': -1.5320864468713296, 'a19': 0.335133396918449, 'a18': 0.43859347353389017, 'a1': -1.176495624543434, 'a0': 0.7668434433727026, 'a3': -0.5820714526053611, 'a2': 0.21268921299897575, 'a5': -0.331168082446819, 'a4': -0.6928365766866853, 'a7': 0.5043329056309176, 'a6': 1.737788013691326, 'a9': 0.5085184489744075, 'a8': -0.7731309329798219, 'a142': 0.14427511365064505, 'a143': 2.033262441401533, 'a140': 0.3433632207017949, 'a141': 0.6130974560602458, 'a146': 0.7858596954870395, 'a147': 0.6600214488756447, 'a144': 1.1386765476374179, 'a145': -1.7988435680038513, 'a148': -0.36860783826369414, 'a149': -0.5389044441942811}, {'a93': -0.5392940210394155, 'a42': 0.8330939846266497, 'a138': 1.2698083620314968, 'a159': -1.2883053898055827, 'a98': -1.0246832333894778, 'a95': -0.19984525006458803, 'a94': 0.44940762684879465, 'a97': 1.188088615656345, 'a96': 0.4636412828529646, 'a91': -0.2456950701160542, 'a90': 1.4860129824575077, 'a153': -1.7602024891810717, 'a92': -0.17836345296704947, 'a79': 0.8260876820945937, 'a78': -0.16129057009456574, 'a77': -0.2810410619446541, 'a76': 0.5781518638405144, 'a75': 0.6161408963201465, 'a74': 0.5616470420020305, 'a73': 1.408459580659752, 'a72': -0.4018831685943821, 'a71': -0.1829386380594027, 'a70': -0.6606042992734863, 'a43': -0.4754879060879305, 'a82': -0.4047981138355037, 'a83': -1.1866976344217497, 'a80': 1.1396472627259484, 'a81': -0.5231369083352644, 'a86': -1.2076814519004804, 'a87': -0.3856200351563017, 'a84': -0.9691478919520404, 'a85': 1.7413134389424054, 'a88': 0.8645984845326343, 'a89': -0.44997318379509893, 'a128': 0.7989113430145288, 'a129': -1.2325044320916936, 'a120': 0.044062428536555676, 'a121': -1.0389753505184014, 'a122': -0.8397390600880786, 'a123': -0.7547750465998985, 'a124': -0.44458397716453935, 'a125': -1.4396889365860024, 'a126': -0.08868038342442591, 'a127': 0.7418807557534427, 'a68': -3.033064246089264, 'a69': -1.0384581247839961, 'a64': 0.3057945029681283, 'a65': -1.8885365141304848, 'a66': 0.5143324904572012, 'a67': 0.29016026075481094, 'a60': -0.918929881631227, 'a61': 0.017222543897432902, 'a62': -0.324584133838586, 'a63': 0.9143174759847232, 'a164': 0.21012602072566897, 'a165': 0.2026020047410895, 'a166': -1.155522208534063, 'a139': 1.094808969480691, 'ssm_id': 'test_V2_ssm_id9', 'a133': -0.07310450753756002, 'a132': 0.6088313540369051, 'a131': -0.08219186217470267, 'a130': 0.7258311047075005, 'a137': 1.1323787586095067, 'a136': 1.2028962900585, 'a135': 0.351946451829228, 'a134': 0.6345964150773694, 'a162': 0.2548921039280174, 'a163': 0.32647837096624377, 'a188': 0.32159703697852454, 'a189': -0.8152448096191109, 'a186': 0.8540233147738011, 'a187': -2.3514478177396096, 'a184': -1.3806936730891397, 'a185': -1.9498336834436298, 'a182': -0.0883209058182523, 'a183': -0.4357011146795796, 'a180': 0.6379374488681443, 'a181': -2.008565348266093, 'a106': 0.2167746864214501, 'a107': -0.5890733742736185, 'a104': -0.7624054444618094, 'a105': -2.900829226281943, 'a102': 1.1842892707712795, 'a103': -2.4363328983971635, 'a100': -1.3123363971105138, 'a101': 0.6933367432549432, 'a108': -0.9039118749236261, 'a109': 0.7386001362445437, 'z99': 4.3, 'a199': -0.49619319309811394, 'a198': -1.2194257096147165, 'a191': -1.145715008992421, 'a190': 1.172685848980512, 'a193': -1.0146900583608536, 'a192': -1.0982651056993395, 'a195': 0.41618250692651665, 'a194': -0.2549785392718591, 'a197': 1.9225576248629412, 'a196': 0.34733403597704343, 'a111': -1.3858449221638833, 'a110': 0.27449153148312855, 'a113': 1.2975149655584202, 'a112': -1.0848271661028195, 'a115': -0.5594765243410522, 'a114': -0.8047681976685885, 'a117': 0.5632371481007274, 'a116': 1.597951584556992, 'a119': -0.30332621981717933, 'a118': -0.6381073310184755, 'a51': 0.7806376192405469, 'a50': -0.870639918846888, 'a53': 0.03543125406761875, 'a52': 0.06905944899077159, 'a55': 0.15968085597854492, 'a54': -1.7707667597030203, 'a57': 0.6009706277168357, 'a56': -0.3093952656607833, 'a59': 1.703455269285987, 'a99': -0.8111828522831847, 'a58': -2.313718695274005, 'a158': -1.444287814657746, 'a33': -0.8433432596594843, 'a32': -0.8465492017383817, 'a31': -0.5371234466246659, 'a30': -0.044195528146735365, 'a37': -0.2326933253733566, 'a36': -0.6295237164908, 'a35': -1.6646267603236102, 'a34': -1.0343693319920926, 'a39': 0.9461129704460464, 'a38': -0.006188749970391787, 'a155': -1.2609363007184575, 'a154': -0.7889436198279396, 'a157': 0.33093717257854033, 'a156': -0.38950115851960526, 'a151': 0.9517662880345319, 'a150': 0.19867577112823187, 'a46': -0.5548612327400986, 'a47': 1.2468032688726325, 'a44': -1.048523084140962, 'a45': 1.501330798743548, 'a160': 0.019588776503770642, 'a161': -0.15806082173537975, 'a40': -0.05640778841995364, 'a41': 1.5038471126780446, 'a152': 1.397931553969056, 'a168': -1.0535453909916281, 'a169': 0.42684693183476885, 'a48': -1.997642314000796, 'a49': -0.05953526797463359, 'a20': 0.626652986397271, 'a21': -1.8578640210919033, 'a22': -0.41049160952391806, 'a23': 0.7825636629399583, 'a24': 0.3557420544191113, 'a25': -0.6949904734541356, 'a26': 0.2684292705009475, 'a27': -1.611866434661492, 'a28': -2.1332095328106355, 'a29': 0.5775714719518896, 'a177': 0.22533674091705705, 'a176': 1.600623583694764, 'a175': 1.5170454806226845, 'a174': 0.8455892209389998, 'a173': 0.3059676933287604, 'a172': -0.8891925701462733, 'a171': 1.5073812480940694, 'a170': -0.2952198580153759, 'a167': -0.06413782010920858, 'a179': 0.7162079710797027, 'a178': -1.1048602473760023, 'a15': 0.01825709999980167, 'a14': 0.09850964668359352, 'a17': -1.2343579050888343, 'a16': -0.5728169686272699, 'a11': -0.756730745934521, 'a10': 0.744545390079962, 'a13': -1.252751506451398, 'a12': 0.6095492328089592, 'a19': 1.154905797853284, 'a18': 0.9232799858167061, 'a1': 0.24466790444045064, 'a0': -0.1253289308675259, 'a3': -0.6632736186273612, 'a2': 0.04491774301520342, 'a5': 0.604827284540204, 'a4': 0.185757038915405, 'a7': 1.0741046193033037, 'a6': 0.7246122188378606, 'a9': -0.08422331598663792, 'a8': -0.9194496033287516, 'a142': 1.0354181583785937, 'a143': 0.053195605032093356, 'a140': 0.9973342915633778, 'a141': -0.5261904925636282, 'a146': -0.17948037400351222, 'a147': -0.0972724197548637, 'a144': 1.2215626896671745, 'a145': 1.1554902746984412, 'a148': 0.34128730402338614, 'a149': 0.035333418288791635}]


#### case 3:     

Li lei want to update some attribute for one security and add some new attributes, and dont want to affect the others attributes



```python
checkpoint_ssm_id = 'test_V2_ssm_id9'
sec_data1 = {'ssm_id':checkpoint_ssm_id, 'a1':9.99, 'new_attr1':4.3, 'new_attr99':9.87}
print 'checkpoint before update :'
print sec.Security.gets(checkpoint_ssm_id)
sec.Security.store(sec_data1)
print '-----------------------------------------------------------'
print 'checkpoint after update :'
print sec.Security.gets(checkpoint_ssm_id)
```

    checkpoint before update :
    [{'a93': -0.5392940210394155, 'a141': -0.5261904925636282, 'a138': 1.2698083620314968, 'a159': -1.2883053898055827, 'a98': -1.0246832333894778, 'a95': -0.19984525006458803, 'a94': 0.44940762684879465, 'a97': 1.188088615656345, 'a96': 0.4636412828529646, 'a91': -0.2456950701160542, 'a90': 1.4860129824575077, 'a153': -1.7602024891810717, 'a92': -0.17836345296704947, 'a79': 0.8260876820945937, 'a78': -0.16129057009456574, 'a77': -0.2810410619446541, 'a76': 0.5781518638405144, 'a75': 0.6161408963201465, 'a74': 0.5616470420020305, 'a73': 1.408459580659752, 'a72': -0.4018831685943821, 'a71': -0.1829386380594027, 'a70': -0.6606042992734863, 'a82': -0.4047981138355037, 'a83': -1.1866976344217497, 'a80': 1.1396472627259484, 'a81': -0.5231369083352644, 'a86': -1.2076814519004804, 'a87': -0.3856200351563017, 'a84': -0.9691478919520404, 'a85': 1.7413134389424054, 'a88': 0.8645984845326343, 'a89': -0.44997318379509893, 'a128': 0.7989113430145288, 'a129': -1.2325044320916936, 'a120': 0.044062428536555676, 'a121': -1.0389753505184014, 'a122': -0.8397390600880786, 'a123': -0.7547750465998985, 'a124': -0.44458397716453935, 'a125': -1.4396889365860024, 'a126': -0.08868038342442591, 'a127': 0.7418807557534427, 'a68': -3.033064246089264, 'a69': -1.0384581247839961, 'a64': 0.3057945029681283, 'a65': -1.8885365141304848, 'a66': 0.5143324904572012, 'a67': 0.29016026075481094, 'a60': -0.918929881631227, 'a61': 0.017222543897432902, 'a62': -0.324584133838586, 'a63': 0.9143174759847232, 'a46': -0.5548612327400986, 'a47': 1.2468032688726325, 'a44': -1.048523084140962, 'a139': 1.094808969480691, 'ssm_id': 'test_V2_ssm_id9', 'a133': -0.07310450753756002, 'a132': 0.6088313540369051, 'a131': -0.08219186217470267, 'a130': 0.7258311047075005, 'a137': 1.1323787586095067, 'a136': 1.2028962900585, 'a135': 0.351946451829228, 'a134': 0.6345964150773694, 'a40': -0.05640778841995364, 'a41': 1.5038471126780446, 'a188': 0.32159703697852454, 'a189': -0.8152448096191109, 'a186': 0.8540233147738011, 'a187': -2.3514478177396096, 'a184': -1.3806936730891397, 'a185': -1.9498336834436298, 'a182': -0.0883209058182523, 'a183': -0.4357011146795796, 'a180': 0.6379374488681443, 'a181': -2.008565348266093, 'a106': 0.2167746864214501, 'a107': -0.5890733742736185, 'a104': -0.7624054444618094, 'a105': -2.900829226281943, 'a102': 1.1842892707712795, 'a103': -2.4363328983971635, 'a100': -1.3123363971105138, 'a101': 0.6933367432549432, 'a108': -0.9039118749236261, 'a109': 0.7386001362445437, 'z99': 4.3, 'a199': -0.49619319309811394, 'a198': -1.2194257096147165, 'a8': -0.9194496033287516, 'a191': -1.145715008992421, 'a190': 1.172685848980512, 'a193': -1.0146900583608536, 'a192': -1.0982651056993395, 'a195': 0.41618250692651665, 'a194': -0.2549785392718591, 'a197': 1.9225576248629412, 'a196': 0.34733403597704343, 'a111': -1.3858449221638833, 'a110': 0.27449153148312855, 'a113': 1.2975149655584202, 'a112': -1.0848271661028195, 'a115': -0.5594765243410522, 'a114': -0.8047681976685885, 'a117': 0.5632371481007274, 'a116': 1.597951584556992, 'a119': -0.30332621981717933, 'a118': -0.6381073310184755, 'a51': 0.7806376192405469, 'a50': -0.870639918846888, 'a53': 0.03543125406761875, 'a52': 0.06905944899077159, 'a55': 0.15968085597854492, 'a54': -1.7707667597030203, 'a57': 0.6009706277168357, 'a56': -0.3093952656607833, 'a59': 1.703455269285987, 'a99': -0.8111828522831847, 'a158': -1.444287814657746, 'a33': -0.8433432596594843, 'a32': -0.8465492017383817, 'a31': -0.5371234466246659, 'a30': -0.044195528146735365, 'a37': -0.2326933253733566, 'a36': -0.6295237164908, 'a35': -1.6646267603236102, 'a34': -1.0343693319920926, 'a39': 0.9461129704460464, 'a38': -0.006188749970391787, 'a155': -1.2609363007184575, 'a58': -2.313718695274005, 'a154': -0.7889436198279396, 'a156': -0.38950115851960526, 'a151': 0.9517662880345319, 'a150': 0.19867577112823187, 'a164': 0.21012602072566897, 'a165': 0.2026020047410895, 'a166': -1.155522208534063, 'a45': 1.501330798743548, 'a42': 0.8330939846266497, 'a43': -0.4754879060879305, 'a162': 0.2548921039280174, 'a163': 0.32647837096624377, 'a152': 1.397931553969056, 'a168': -1.0535453909916281, 'a169': 0.42684693183476885, 'a48': -1.997642314000796, 'a49': -0.05953526797463359, 'a20': 0.626652986397271, 'a21': -1.8578640210919033, 'a22': -0.41049160952391806, 'a23': 0.7825636629399583, 'a24': 0.3557420544191113, 'a25': -0.6949904734541356, 'a26': 0.2684292705009475, 'a27': -1.611866434661492, 'a28': -2.1332095328106355, 'a29': 0.5775714719518896, 'new_attr99': 9.87, 'a177': 0.22533674091705705, 'a176': 1.600623583694764, 'a175': 1.5170454806226845, 'a174': 0.8455892209389998, 'a173': 0.3059676933287604, 'a172': -0.8891925701462733, 'a171': 1.5073812480940694, 'a170': -0.2952198580153759, 'a167': -0.06413782010920858, 'a179': 0.7162079710797027, 'a178': -1.1048602473760023, 'a15': 0.01825709999980167, 'a14': 0.09850964668359352, 'a17': -1.2343579050888343, 'a16': -0.5728169686272699, 'a11': -0.756730745934521, 'a10': 0.744545390079962, 'a13': -1.252751506451398, 'a12': 0.6095492328089592, 'a145': 1.1554902746984412, 'a19': 1.154905797853284, 'a18': 0.9232799858167061, 'a1': 9.99, 'a0': -0.1253289308675259, 'a3': -0.6632736186273612, 'a2': 0.04491774301520342, 'a5': 0.604827284540204, 'a4': 0.185757038915405, 'a7': 1.0741046193033037, 'a6': 0.7246122188378606, 'a9': -0.08422331598663792, 'a160': 0.019588776503770642, 'new_attr1': 4.3, 'a142': 1.0354181583785937, 'a143': 0.053195605032093356, 'a140': 0.9973342915633778, 'a157': 0.33093717257854033, 'a146': -0.17948037400351222, 'a147': -0.0972724197548637, 'a144': 1.2215626896671745, 'a161': -0.15806082173537975, 'a148': 0.34128730402338614, 'a149': 0.035333418288791635}]
    -----------------------------------------------------------
    checkpoint after update :
    [{'a161': -0.15806082173537975, 'a138': 1.2698083620314968, 'a159': -1.2883053898055827, 'a98': -1.0246832333894778, 'a95': -0.19984525006458803, 'a94': 0.44940762684879465, 'a97': 1.188088615656345, 'a96': 0.4636412828529646, 'a91': -0.2456950701160542, 'a90': 1.4860129824575077, 'a153': -1.7602024891810717, 'a92': -0.17836345296704947, 'a79': 0.8260876820945937, 'a78': -0.16129057009456574, 'a77': -0.2810410619446541, 'a76': 0.5781518638405144, 'a75': 0.6161408963201465, 'a74': 0.5616470420020305, 'a73': 1.408459580659752, 'a72': -0.4018831685943821, 'a71': -0.1829386380594027, 'a70': -0.6606042992734863, 'a43': -0.4754879060879305, 'a82': -0.4047981138355037, 'a83': -1.1866976344217497, 'a80': 1.1396472627259484, 'a81': -0.5231369083352644, 'a86': -1.2076814519004804, 'a87': -0.3856200351563017, 'a84': -0.9691478919520404, 'a85': 1.7413134389424054, 'a88': 0.8645984845326343, 'a89': -0.44997318379509893, 'a128': 0.7989113430145288, 'a129': -1.2325044320916936, 'a120': 0.044062428536555676, 'a121': -1.0389753505184014, 'a122': -0.8397390600880786, 'a123': -0.7547750465998985, 'a124': -0.44458397716453935, 'a125': -1.4396889365860024, 'a126': -0.08868038342442591, 'a127': 0.7418807557534427, 'a68': -3.033064246089264, 'a69': -1.0384581247839961, 'a64': 0.3057945029681283, 'a65': -1.8885365141304848, 'a66': 0.5143324904572012, 'a67': 0.29016026075481094, 'a60': -0.918929881631227, 'a61': 0.017222543897432902, 'a62': -0.324584133838586, 'a63': 0.9143174759847232, 'a164': 0.21012602072566897, 'a165': 0.2026020047410895, 'a166': -1.155522208534063, 'a139': 1.094808969480691, 'ssm_id': 'test_V2_ssm_id9', 'a133': -0.07310450753756002, 'a132': 0.6088313540369051, 'a131': -0.08219186217470267, 'a130': 0.7258311047075005, 'a137': 1.1323787586095067, 'a136': 1.2028962900585, 'a135': 0.351946451829228, 'a134': 0.6345964150773694, 'a162': 0.2548921039280174, 'a163': 0.32647837096624377, 'a188': 0.32159703697852454, 'a189': -0.8152448096191109, 'a186': 0.8540233147738011, 'a187': -2.3514478177396096, 'a184': -1.3806936730891397, 'a185': -1.9498336834436298, 'a182': -0.0883209058182523, 'a183': -0.4357011146795796, 'a180': 0.6379374488681443, 'a181': -2.008565348266093, 'a106': 0.2167746864214501, 'a107': -0.5890733742736185, 'a104': -0.7624054444618094, 'a105': -2.900829226281943, 'a102': 1.1842892707712795, 'a103': -2.4363328983971635, 'a100': -1.3123363971105138, 'a101': 0.6933367432549432, 'a108': -0.9039118749236261, 'a109': 0.7386001362445437, 'z99': 4.3, 'a160': 0.019588776503770642, 'a199': -0.49619319309811394, 'a198': -1.2194257096147165, 'a191': -1.145715008992421, 'a190': 1.172685848980512, 'a193': -1.0146900583608536, 'a192': -1.0982651056993395, 'a195': 0.41618250692651665, 'a194': -0.2549785392718591, 'a197': 1.9225576248629412, 'a196': 0.34733403597704343, 'a111': -1.3858449221638833, 'a110': 0.27449153148312855, 'a113': 1.2975149655584202, 'a112': -1.0848271661028195, 'a115': -0.5594765243410522, 'a114': -0.8047681976685885, 'a117': 0.5632371481007274, 'a116': 1.597951584556992, 'a119': -0.30332621981717933, 'a118': -0.6381073310184755, 'a51': 0.7806376192405469, 'a50': -0.870639918846888, 'a53': 0.03543125406761875, 'a52': 0.06905944899077159, 'a55': 0.15968085597854492, 'a54': -1.7707667597030203, 'a57': 0.6009706277168357, 'a56': -0.3093952656607833, 'a59': 1.703455269285987, 'a99': -0.8111828522831847, 'a158': -1.444287814657746, 'a33': -0.8433432596594843, 'a32': -0.8465492017383817, 'a31': -0.5371234466246659, 'a30': -0.044195528146735365, 'a37': -0.2326933253733566, 'a36': -0.6295237164908, 'a35': -1.6646267603236102, 'a34': -1.0343693319920926, 'a39': 0.9461129704460464, 'a38': -0.006188749970391787, 'a155': -1.2609363007184575, 'a58': -2.313718695274005, 'a154': -0.7889436198279396, 'a156': -0.38950115851960526, 'a151': 0.9517662880345319, 'a150': 0.19867577112823187, 'a46': -0.5548612327400986, 'a47': 1.2468032688726325, 'a44': -1.048523084140962, 'a45': 1.501330798743548, 'a42': 0.8330939846266497, 'a93': -0.5392940210394155, 'a40': -0.05640778841995364, 'a41': 1.5038471126780446, 'a152': 1.397931553969056, 'a168': -1.0535453909916281, 'a169': 0.42684693183476885, 'a48': -1.997642314000796, 'a49': -0.05953526797463359, 'a20': 0.626652986397271, 'a21': -1.8578640210919033, 'a22': -0.41049160952391806, 'a23': 0.7825636629399583, 'a24': 0.3557420544191113, 'a25': -0.6949904734541356, 'a26': 0.2684292705009475, 'a27': -1.611866434661492, 'a28': -2.1332095328106355, 'a29': 0.5775714719518896, 'new_attr99': 9.87, 'a177': 0.22533674091705705, 'a176': 1.600623583694764, 'a175': 1.5170454806226845, 'a174': 0.8455892209389998, 'a173': 0.3059676933287604, 'a172': -0.8891925701462733, 'a171': 1.5073812480940694, 'a170': -0.2952198580153759, 'a167': -0.06413782010920858, 'a179': 0.7162079710797027, 'a178': -1.1048602473760023, 'a15': 0.01825709999980167, 'a14': 0.09850964668359352, 'a17': -1.2343579050888343, 'a16': -0.5728169686272699, 'a11': -0.756730745934521, 'a10': 0.744545390079962, 'a13': -1.252751506451398, 'a12': 0.6095492328089592, 'a19': 1.154905797853284, 'a18': 0.9232799858167061, 'a1': 9.99, 'a0': -0.1253289308675259, 'a3': -0.6632736186273612, 'a2': 0.04491774301520342, 'a5': 0.604827284540204, 'a4': 0.185757038915405, 'a7': 1.0741046193033037, 'a6': 0.7246122188378606, 'a9': -0.08422331598663792, 'a8': -0.9194496033287516, 'new_attr1': 4.3, 'a157': 0.33093717257854033, 'a142': 1.0354181583785937, 'a143': 0.053195605032093356, 'a140': 0.9973342915633778, 'a141': -0.5261904925636282, 'a146': -0.17948037400351222, 'a147': -0.0972724197548637, 'a144': 1.2215626896671745, 'a145': 1.1554902746984412, 'a148': 0.34128730402338614, 'a149': 0.035333418288791635}]


#### case 4:    
Li Lei wants to delete all data stored through this API


```python
all_ids = sec.Security.getall()
sec.Security.deletes(all_ids)
```

    100003  datas was deleted!


### Benchmark

devpmapp3   
store 50K data, 4s
store 500K data, 48s


```python
from datetime import datetime
time1 = datetime.now()
sec.Security.store(source_datas[:50000])
time2 = datetime.now()
print 'store 50K data, use: ',time2-time1
```

    store 50K data, use:  0:00:09.458434

